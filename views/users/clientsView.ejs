<% layout('/layout/boilerplate') -%>

<!-- ================= TABULATOR CSS ================= -->
<link
  href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css"
  rel="stylesheet"
/>

<div class="contain" style="flex-direction: column; padding: 10px; gap: 10px">
  <div class="indi-head">
    <h1>Clients</h1>

    <div class="download-selector" id="downloadSelector">
      <button class="download-selector__trigger">
        <span>
          <i class="fa-solid fa-file-arrow-down"></i> Download
        </span>
        <i class="fas fa-chevron-down"></i>
      </button>

      <div class="download-selector__menu">
        <div class="download-selector__option" id="download-pdf">
          <i class="fas fa-file-pdf"></i> PDF
        </div>
        <div class="download-selector__option" id="download-xlsx">
          <i class="fas fa-file-excel"></i> Excel
        </div>
      </div>
    </div>
  </div>

  <div id="master-table"></div>
</div>

<!-- ================= SCRIPTS ================= -->

<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
  /* ===== Dropdown ===== */
  const downloadSelector = document.getElementById("downloadSelector");
  const triggerBtn = downloadSelector.querySelector(".download-selector__trigger");

  triggerBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    downloadSelector.classList.toggle("download-selector--active");
  });

  document.addEventListener("click", () => {
    downloadSelector.classList.remove("download-selector--active");
  });

  /* ===== Table ===== */
  const tableData = <%- JSON.stringify(jsonData) %>;

  const table = new Tabulator("#master-table", {
    data: tableData,
    layout: "fitColumns",
    pagination: "local",
    paginationSize: 25,
    movableColumns: true,
    resizableColumns: true,

    columns: [
      { title: "Client ID", field: "clientId" },
      { title: "Client Name", field: "clientName", headerFilter: true },
      { title: "Type", field: "clientType" },
      { title: "HO Location", field: "hoLocation" },
      { title: "Account Head", field: "accountHead" },
      { title: "GST No", field: "clientGst" },
      { title: "PAN", field: "clientPan" },
      { title: "MSME", field: "clientMsme" },
      { title: "Gumasta", field: "clientGumasta" },
      {
        title: "Status",
        field: "clientStatus",
        formatter: (cell) =>
          `<span style="font-weight:600;color:green;">${cell.getValue()}</span>`,
      },
    ],
  });

  /* ===== Downloads ===== */
  document.getElementById("download-pdf").addEventListener("click", () => {
    table.download("pdf", "clients.pdf", {
      orientation: "landscape",
      format: "a3",
      title: "Clients",
    });
    downloadSelector.classList.remove("download-selector--active");
  });

  document.getElementById("download-xlsx").addEventListener("click", () => {
    table.download("xlsx", "clients.xlsx", {
      sheetName: "Clients",
    });
    downloadSelector.classList.remove("download-selector--active");
  });
</script>
