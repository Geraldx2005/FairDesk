<% layout('/layout/boilerplate') -%>

<div class="main-content">
  <form class="rottary-content" method="post" action="/fairdesk/pettycash/create" >

    <!-- ================= FORM HEADING ================= -->
    <div class="span-full form-heading" style="display: flex; justify-content: space-between; flex-direction: row;" >
            <div class="span-five" style="display: flex; gap: 6px; justify-content: start; flex-direction: row; width: auto;">
        <label style="width: auto;">
          Location
        </label>
        <select name="location" id="locationSelect" class="form-control select-tag" style="width:130px" required >
          <option value="" disabled selected hidden>Select Location</option>
          <option value="OFFICE">OFFICE</option>
          <option value="UNIT 1">UNIT 1</option>
          <option value="UNIT 2">UNIT 2</option>
          <option value="UNIT 3">UNIT 3</option>
        </select>

      </div>
      <h1>Petty Cash Entry</h1>

      <!-- ================= CURRENT BALANCE ================= -->
      <!-- ================= CURRENT BALANCE ================= -->
      <div
        class="span-five"
        id="balanceWrap"
        style="display:flex; gap:6px; justify-content:end; flex-direction:row; width:auto"
      >
        <label style="width:auto">Current Balance</label>
        <input type="number" id="currentBalance" class="form-control input-tag" style="width:100px" value="0" readonly />
        </div>
    </div>

    <!-- ================= TRANSACTION TYPE ================= -->
    <div class="span-dual">
      <label>Transaction Type</label>
      <select name="type" id="txnType" class="form-control select-tag" required>
      <option value="PAID" selected>PAID</option>
      <option value="RECEIVED">RECEIVED</option>
    </select>
    </div>    

    <!-- ================= FROM ================= -->
    <div class="span-dual">
      <label id="fromLabel">From</label>
      <input type="text" name="from" id="fromInput" class="form-control input-tag" placeholder="Owner / Bank / Office" required />
    </div>

    <div class="span-dual" id="toWrap">
      <label>To</label>
      <input type="text" name="to" id="toInput" class="form-control input-tag" placeholder="Vendor / Expense / Person" required />
    </div>

    <!-- ================= AMOUNT ================= -->
    <div class="span-dual">
      <label>Amount</label>
      <input type="number" name="amount" class="form-control input-tag" placeholder="Enter amount" min="1" required />
    </div>

    <!-- ================= REASON ================= -->
    <div class="span-dual">
      <label>Reason</label>
      <input type="text" name="reason" class="form-control input-tag" placeholder="Optional" />
    </div>

    <!-- ================= SUBMIT BUTTON ================= -->
    <div class="span-full btn-grp">
      <button class="submit-btn" type="submit">
        Save Petty Cash
      </button>
    </div>

  </form>
</div>

<script>
  /* ===== ELEMENTS ===== */
  const locationSelect = document.getElementById("locationSelect");
  const balanceInput = document.getElementById("currentBalance");

  const txnType = document.getElementById("txnType");
  const fromInput = document.getElementById("fromInput");
  const toInput = document.getElementById("toInput");
  const fromWrap = fromInput.closest(".span-dual");
  const toWrap = document.getElementById("toWrap");

  balanceInput.value = 0;

  /* ===== LOCATION → FETCH BALANCE ===== */
  locationSelect.addEventListener("change", async () => {
    const loc = locationSelect.value;
    if (!loc) return;

    try {
      const res = await fetch(`/fairdesk/pettycash/balance/${loc}`);
      const data = await res.json();
      balanceInput.value = data.balance ?? 0;
    } catch {
      balanceInput.value = 0;
    }
  });

  /* ===== TRANSACTION TYPE → VISIBILITY + REQUIRED FIX ===== */
  function syncFields() {
    if (txnType.value === "PAID") {
      // PAID → only TO
      fromWrap.style.display = "none";
      fromInput.required = false;
      fromInput.value = "";

      toWrap.style.display = "block";
      toInput.required = true;
    } else {
      // RECEIVED → only FROM
      toWrap.style.display = "none";
      toInput.required = false;
      toInput.value = "";

      fromWrap.style.display = "block";
      fromInput.required = true;
    }
  }

  txnType.addEventListener("change", syncFields);
  syncFields(); // on load
</script>



