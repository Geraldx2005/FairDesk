<!--- Link to boilerplate.ejs -->
<% layout('/layout/boilerplate') -%>
<style>
/* Force ONLY this span-dual to be horizontal */
/* Force ONLY this span-hexa block to be horizontal */
#die-remark-div {
  display: flex !important;
  flex-direction: row !important;
  align-items: center;
  gap: 12px;
}

/* Image on the LEFT */
#empPhotoPreview {
  width: 60px;
  height: 60px;
  object-fit: cover;          /* fill without distortion */
  object-position: center 60%;/* optional: shift image down inside frame */
  border-radius: 8px;
  border: 1px solid #ccc;
  background-color: #f3f3f3;
  display: none;
  flex-shrink: 0;             /* keeps it on the left */
}

/* Right side: label above input + full width */
.photo-upload-wrapper {
  display: flex;
  flex-direction: column;
  gap: 4px;

  flex: 1;        /* ⬅️ take remaining width */
  min-width: 0;   /* ⬅️ required for flex inputs */
}

/* Make input stretch fully */
.photo-upload-wrapper input {
  width: 100%;
}

/* Clickable image */
#empPhotoPreview {
  cursor: pointer;
  transition: transform 0.2s ease;
}

#empPhotoPreview:hover {
  transform: scale(1.05);
}

/* Modal overlay */
.image-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  z-index: 9999;
  justify-content: center;
  align-items: center;
}

/* Enlarged image */
.image-modal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 10px;
}

/* Close button */
.close-btn {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 36px;
  color: white;
  cursor: pointer;
}

</style>

<div class="main-content">
    <form
      method="post"
      enctype="multipart/form-data"
      action="<%= employee ? `/fairdesk/employee/edit/${employee._id}` : '/fairdesk/employee/form' %>"
    >

    <div class="span-full form-heading">
        <h1>Employment</h1>
    </div>    

    <div class="span-six">
      <label for="emp-id">Employee ID</label>
      <input
        type="text"
        name="empId"
        class="form-control input-tag emp-id-display"
        value="<%= employee ? employee.empId : `FS | EMPLOYEE | ${employeeCount.toString().padStart(3,'0')}` %>"
        readonly
        tabindex="-1"
      >
    </div>

    <div class="span-six">
      <label for="emp-date-of-joining">Date of Joining</label>
      <input type="date" id="emp-date-of-joining" value="<%= employee?.empDateOfJoining || '' %>" class="form-control input-tag" name="empDateOfJoining" placeholder="Enter Date of Joining" required/>
    </div>

    <div class="span-five">
      <label for="emp-type">Employee Type</label>
       <select name="empType" class="form-control select-tag">
        <option value="" disabled selected hidden>Select</option>
        <option value="SKILLED" <%= employee?.empType === 'SKILLED' ? 'selected' : '' %>>SKILLED</option>
        <option value="UNSKILLED" <%= employee?.empType === 'UNSKILLED' ? 'selected' : '' %>>UNSKILLED</option>
      </select>
    </div>

    <div class="span-four">
      <label for="emp-under">Under</label>
       <select name="empUnder" class="form-control select-tag" required>
        <option value="" disabled selected hidden>Select</option>
        <option value="TECH" <%= employee?.empUnder === 'TECH' ? 'selected' : '' %>>TECH</option>
        <option value="TAGS" <%= employee?.empUnder === 'TAGS' ? 'selected' : '' %>>TAGS</option>
        <option value="SACHIKO" <%= employee?.empUnder === 'SACHIKO' ? 'selected' : '' %>>SACHIKO</option>
        <option value="CONTRACT" <%= employee?.empUnder === 'CONTRACT' ? 'selected' : '' %>>CONTRACT</option>
       </select>
    </div>   
    
    <div class="span-four">
      <label for="emp-loc">Location</label>
      <select name="empLoc" class="form-control select-tag" required>
        <option value="" disabled selected hidden>Select</option>
        <option value="OFFICE" <%= employee?.empLoc === 'OFFICE' ? 'selected' : '' %>>OFFICE</option>
        <option value="UNIT 1" <%= employee?.empLoc === 'UNIT 1' ? 'selected' : '' %>>UNIT 1</option>
        <option value="UNIT 2" <%= employee?.empLoc === 'UNIT 2' ? 'selected' : '' %>>UNIT 2</option>
        <option value="UNIT 3" <%= employee?.empLoc === 'UNIT 3' ? 'selected' : '' %>>UNIT 3</option>
      </select>
    </div>
    
    <div class="span-seven span-row-2">
      <label for="emp-assets">Assets</label>
      <input type="text" name="empAssets1" value="<%= employee?.empAssets1 || '' %>" placeholder="1" id="emp-assets" class="form-control select-tag"/>
      <input type="text" name="empAssets2" value="<%= employee?.empAssets2 || '' %>" placeholder="2" id="emp-assets" class="form-control select-tag"/>
      <input type="text" name="empAssets3" value="<%= employee?.empAssets3 || '' %>" placeholder="3" id="emp-assets" class="form-control select-tag"/>
      <input type="text" name="empAssets4" value="<%= employee?.empAssets4 || '' %>" placeholder="4" id="emp-assets" class="form-control select-tag"/>
    </div>

    <div class="span-four">
      <label for="emp-dept">Department</label>
      <input type="text" id="emp-dept" class="form-control input-tag" name="empDept" value="<%= employee?.empDept || '' %>" placeholder="Enter Department" required/>
    </div>

    <div class="span-six">
      <label for="emp-reporting-manager">Reporting Manager</label>
      <input type="text" id="emp-reporting-manager" class="form-control input-tag" name="empReportingManager" value="<%= employee?.empReportingManager || '' %>" placeholder="Enter Reporting Manager" required/>
    </div>

    <div class="span-four">
      <label for="emp-profile">Profile</label>
      <input type="text" id="emp-profile" class="form-control input-tag" name="empProfile" value="<%= employee?.empProfile || '' %>" placeholder="Enter Profile" required/>
    </div>

    <div class="span-five">
      <label for="emp-office-mob">Office Mobile No</label>
      <input type="text" inputmode="numeric" id="emp-office-mob" class="form-control input-tag" name="empOfficeMob" value="<%= employee?.empOfficeMob || '' %>" placeholder="Enter Office Mobile No"/>
    </div>

    <div class="span-six">
      <label for="emp-office-email-id">Office Email ID</label>
      <input type="email" id="emp-office-email-id" class="form-control input-tag" name="empOfficeEmailId" value="<%= employee?.empOfficeEmailId || '' %>" placeholder="Enter Office Email ID"/>
    </div>

    <div class="span-full form-subheading">
      <h1>Employee Details</h1>
    </div>

    <div class="span-penta">
      <label for="emp-name">Name</label>
      <input type="text" id="emp-name" class="form-control input-tag" name="empName" value="<%= employee?.empName || '' %>" placeholder="Enter Name" required />
    </div>

    <div class="span-five">
      <label for="emp-dob">D.O.B</label>
      <input type="date" id="emp-dob" class="form-control input-tag" name="empDob" value="<%= employee?.empDob || '' %>" placeholder="Enter D.O.B required" />
    </div>

    <div class="span-five">
      <label for="emp-gender">Gender</label>
       <select name="empGender" class="form-control select-tag" required>
        <option value="" disabled selected hidden>Select</option>
        <option value="MALE" <%= employee?.empGender === 'MALE' ? 'selected' : '' %>>MALE</option>
        <option value="FEMALE" <%= employee?.empGender === 'FEMALE' ? 'selected' : '' %>>FEMALE</option>
       </select>
    </div>

    <div class="span-six">
      <label for="emp-mobile1">Mobile No 1</label>
      <input type="text" inputmode="numeric"  id="emp-mobile1" class="form-control input-tag" name="empMobile1" value="<%= employee?.empMobile1 || '' %>" placeholder="Enter Mobile No 1" required/>
    </div>

    <div class="span-six">
      <label for="emp-mobile2">Mobile No 2</label>
      <input type="text" inputmode="numeric" id="emp-mobile2" class="form-control input-tag" name="empMobile2" value="<%= employee?.empMobile2 || '' %>" placeholder="Enter Mobile No 2" />
    </div>

    <div class="span-six">
      <label for="emp-emergency-no1">Emergency No 1</label>
      <input type="text" inputmode="numeric" id="emp-emergency-no1" class="form-control input-tag" name="empEmergencyNo1" value="<%= employee?.empEmergencyNo1 || '' %>" placeholder="Enter emergency No" required/>
    </div> 

    <div class="span-six">
      <label for="emp-emergency-no2">Emergency No 2</label>
      <input type="text" inputmode="numeric" id="emp-emergency-no2" class="form-control input-tag" name="empEmergencyNo2" value="<%= employee?.empEmergencyNo2 || '' %>" placeholder="Enter emergency No" />
    </div>    

    <div class="span-seven">
      <label for="emp-email">Email</label>
      <input type="email" id="emp-email" class="form-control input-tag" name="empEmail" value="<%= employee?.empEmail || '' %>" placeholder="Enter Email" required />
    </div>

    <div class="span-six">
      <label for="emp-martial-status">Martial Status</label>
       <select name="empMartialStatus" class="form-control select-tag" required>
        <option value="" disabled selected hidden>Select</option>
        <option value="SINGLE" <%= employee?.empMartialStatus === 'SINGLE' ? 'selected' : '' %>>SINGLE</option>
        <option value="MARRIED" <%= employee?.empMartialStatus === 'MARRIED' ? 'selected' : '' %>>MARRIED</option>
       </select>
    </div>
    
    <div class="span-seven">
      <label for="emp-marriage-anniversary">Marriage Anniv</label>
      <input type="date" id="emp-marriage-anniversary" class="form-control input-tag" name="empMarriageAnniversary" value="<%= employee?.empMarriageAnniversary || '' %>" placeholder="Enter Marriage Anniversary" />
    </div>

    <div class="span-penta">
      <label for="emp-present-address">Present Address</label>
      <textarea
        id="emp-present-address"
        class="form-control input-tag"
        name="empPresentAddress"
        placeholder="Enter Employee Present Address"
        rows="3"
        style="border: 1px solid #1a1a2e; resize: none;"
      ><%= employee?.empPresentAddress || '' %></textarea>
    </div>

    <div class="span-hexa">
      <label for="emp-permanent-address">Permanent Address</label>
      <textarea
        id="emp-permanent-address"
        class="form-control input-tag"
        name="empPermanentAddress"
        placeholder="Enter Employee Permanent Address"
        rows="3"
        style="border: 1px solid #1a1a2e; resize: none;"
      ><%= employee?.empPermanentAddress || '' %></textarea>
    </div>

    <div class="span-penta">
      <label for="emp-hobbies">Hobbies & Interests</label>
      <textarea
        id="emp-hobbies"
        class="form-control input-tag"
        name="empHobbies"
        placeholder="Enter Employee Hobbies & Interests"
        rows="3"
        style="border: 1px solid #1a1a2e; resize: none;"
      ><%= employee?.empHobbies || '' %></textarea>
    </div>       

    <div class="span-full form-subheading">
        <h1>Identification</h1>
    </div>    

    <div class="span-eight" id="die-remark-div">  
      <img id="empPhotoPreview" alt="Preview" />
      <div class="photo-upload-wrapper">
        <label for="emp-photo">Photo</label>
        <input
          type="file"
          id="emp-photo"
          class="form-control input-tag"
          name="empPhoto"
          accept="image/*"
        />
      </div>
    </div>
 
    <div class="span-six">
      <label for="emp-aadhaar">Aadhaar</label>
      <input type="text" inputmode="numeric" id="emp-aadhaar" class="form-control input-tag" name="empAadhaar" value="<%= employee?.empAadhaar || '' %>" placeholder="Enter Aadhaar" />
    </div>

    <div class="span-six" id="die-remark-div">  
      <!-- <img id="empAadhaarPreview" alt="Preview" /> -->
      <div class="photo-upload-wrapper">
        <label for="emp-aadhaar-img">Aadhaar Image</label>
        <input type="file" id="emp-photo" class="form-control input-tag" name="empPhoto" accept="image/*" />
      </div>
    </div>    

    <div class="span-six">
      <label for="emp-pan">PAN</label>
      <input type="text" id="emp-pan" class="form-control input-tag" maxlength="10" name="empPan" value="<%= employee?.empPan || '' %>" placeholder="Enter PAN" required />
    </div>

    <div class="span-six" id="die-remark-div">  
      <!-- <img id="empAadhaarPreview" alt="Preview" /> -->
      <div class="photo-upload-wrapper">
        <label for="emp-pan-img">PAN Image</label>
        <input type="file" id="emp-pan-img" class="form-control input-tag" name="empPanImg" accept="image/*" />
      </div>
    </div>       

    <div class="span-full form-subheading">
        <h1>Banking</h1>
    </div>      

    <div class="span-dual">
      <label for="emp-bank-name">Bank Name</label>
      <input type="text" id="emp-bank-name" class="form-control input-tag" name="empBankName" value="<%= employee?.empBankName || '' %>" placeholder="Enter Bank Name" required />
    </div>

    <div class="span-dual">
      <label for="emp-account-holder-name">Account Holder Name</label>
      <input type="text" id="emp-account-holder-name" class="form-control input-tag" name="empAccountHolderName" value="<%= employee?.empAccountHolderName || '' %>" placeholder="Enter Account Holder Name" required />
    </div>

    <div class="span-dual">
      <label for="emp-acc-no">Account No</label>
      <input type="text" id="emp-acc-no" class="form-control input-tag" name="empAccNo" value="<%= employee?.empAccNo || '' %>" placeholder="Enter Account No" required />
    </div>

    <div class="span-dual">
      <label for="emp-ifsc-code">IFSC Code</label>
        <input type="text" id="emp-ifsc-code" class="form-control input-tag" name="empIfscCode" value="<%= employee?.empIfscCode || '' %>" placeholder="Enter IFSC Code" maxlength="11" autocomplete="off" required />
    </div>

    <div class="span-full form-subheading">
        <h1>Deductions</h1>
    </div>     

    <div class="span-four">
      <label for="emp-pt">PT</label>
      <input type="number" id="emp-pt" class="form-control input-tag" name="empPT" value="<%= employee?.empPT || '' %>" placeholder="Enter PT" required />
    </div>    

    <div class="span-four">
      <label for="emp-tds">TDS</label>
      <input type="number" id="emp-tds" class="form-control input-tag" name="empTDS" value="<%= employee?.empTDS || '' %>" placeholder="Enter TDS" required />
    </div>    

    <div class="span-four">
      <label for="emp-lic">LIC</label>
      <input type="number" id="emp-lic" class="form-control input-tag" name="empLIC" value="<%= employee?.empLIC || '' %>" placeholder="Enter LIC" required />
    </div>    

    <div class="span-five">
      <label for="emp-medical">Medical</label>
      <input type="number" id="emp-medical" class="form-control input-tag" name="empMedical" value="<%= employee?.empMedical || '' %>" placeholder="Enter Medical" required />
    </div>    

    <div class="span-five">
      <label for="emp-nsic">NSIC</label>
      <input type="number" id="emp-nsic" class="form-control input-tag" name="empNSIC" value="<%= employee?.empNSIC || '' %>" placeholder="Enter NSIC" required />
    </div>    

    <div class="span-five">
      <label for="emp-esic">ESIC</label>
      <input type="number" id="emp-esic" class="form-control input-tag" name="empESIC" value="<%= employee?.empESIC || '' %>" placeholder="Enter ESIC" required />
    </div>    

    <div class="span-five">
      <label for="emp-pf">PF</label>
      <input type="number" id="emp-pf" class="form-control input-tag" name="empPF" value="<%= employee?.empPF || '' %>" placeholder="Enter PF" required />
    </div>
    
    <div class="span-full form-subheading">
      <h1>Payroll Details</h1>
    </div>

    <div class="span-five">
      <label for="basicSalary">Basic Salary</label>
      <input type="number" name="basicSalary" value="<%= employee?.basicSalary || '' %>" id="basicSalary" class="form-control input-tag" placeholder="Enter Basic Salary">
    </div>

    <div class="span-five">
      <label for="railwayPass">Railway Pass</label>
      <input type="number" name="railwayPass" value="<%= employee?.railwayPass || '' %>" id="railwayPass"  class="form-control input-tag" placeholder="Enter Railway Pass">
    </div>

    <div class="span-four">
      <label for="travelling">Travelling</label>
      <input type="number" name="travelling" value="<%= employee?.travelling || '' %>" id="travelling" class="form-control input-tag" placeholder="Enter Travelling">
    </div>

    <div class="span-five">
      <label for="houseRent">House Rent</label>
      <input type="number" name="houseRent" value="<%= employee?.houseRent || '' %>" id="houseRent" class="form-control input-tag" placeholder="Enter House Rent">
    </div>
    <div class="span-five">
      <label for="staffQuarters">Staff Quaters</label>
      <input type="number" name="staffQuarters" value="<%= employee?.staffQuarters || '' %>" id="staffQuarters" class="form-control input-tag" placeholder="Enter House Rent">
    </div>

    <div class="span-four">
      <label for="otRatePerHour">OT Per Hour</label>
      <input type="number" name="otRatePerHour" value="<%= employee?.otRatePerHour || '' %>" id="otRatePerHour" class="form-control input-tag" placeholder="Enter OT">
    </div>

    <div class="span-four">
      <label for="bonus">Bonus %</label>
      <input type="number" name="bonus" value="<%= employee?.bonus || '' %>" id="bonus" class="form-control input-tag" placeholder="Enter Bonus">
    </div>
    
    <div class="span-full form-subheading" style="display: flex; align-items: center;">
        <h1>Dependents Details</h1>
        <input type="text" id="dependents-count" style="width: 130px; height: 25px; margin-left: 20px;"  maxlength="2" class="form-control" name="dependentsCount" placeholder="Dependents Count"/>
    </div>

    <div class="dependent-headings" style="margin-bottom: 0px; grid-column: span 32; background-color: #1a1a2e; color: white; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;"> 
      <span style="flex: 1; font-size: 16px; font-weight: 600; padding-left: 15px;">Name</span>
      <span style="flex: 1; font-size: 16px; font-weight: 600; padding-left: 15px;">DOB</span>
      <span style="flex: 1; font-size: 16px; font-weight: 600; padding-left: 15px;">Relation</span>
    </div> 
    
    <div id="dependents-details" style="grid-column: span 32;">
        <div class="dependents-details" style="margin-bottom: 10px; grid-column: span 32; padding: 10px; border-radius: 5px; border: 2px solid #1a1a2e; display: flex; justify-content: space-between; align-items: center; gap: 10px;">
          <input type="text" class="form-control" value="-" style="flex: 1; border: 1px solid #1a1a2e;" tabindex="-1" readonly />
          <input type="text" class="form-control" value="-" style="flex: 1; border: 1px solid #1a1a2e;" tabindex="-1" readonly />
          <input type="text" class="form-control" value="-" style="flex: 1; border: 1px solid #1a1a2e;" tabindex="-1" readonly />
        </div>
    </div>

    <div class="span-full btn-grp">
      <button class="submit-btn" type="submit">Save Employee</button>
    </div>
  </form>
</div>

<!-- Image Preview Modal -->
<div id="imageModal" class="image-modal">
  <span class="close-btn">&times;</span>
  <img id="modalImage" />
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/selectize/dist/js/standalone/selectize.min.js"></script>
<script>
  const dependentsData = <%- JSON.stringify(employee?.dependentsDetails || []) %>;
</script>
<script>
  document.getElementById('dependents-count').addEventListener('input', function() {
    const count = parseInt(this.value) || 0;
    const container = document.getElementById('dependents-details');
    
    // Clear existing content
    container.innerHTML = '';
    
    if (count <= 0 || isNaN(count)) {
        // Create empty state div
        const emptyDiv = document.createElement('div');
        emptyDiv.className = 'dependents-headings';
        emptyDiv.style.cssText = 'margin-bottom: 10px; grid-column: span 32; padding: 10px; border-radius: 5px; border: 2px solid #1a1a2e; display: flex; justify-content: space-between; align-items: center; gap: 10px;';
        
        emptyDiv.innerHTML = `
            <input type="text" class="form-control" value="-" style="flex: 1; border: 1px solid #1a1a2e;" readonly>
            <input type="text" class="form-control" value="-" style="flex: 1; border: 1px solid #1a1a2e;" readonly>
            <input type="text" class="form-control" value="-" style="flex: 1; border: 1px solid #1a1a2e;" readonly>
        `;
        container.appendChild(emptyDiv);
    } else {
        // Create new divs based on the input count
        for (let i = 0; i < count; i++) {
            const div = document.createElement('div');
            div.className = 'dependents-headings';
            div.style.cssText = 'margin-bottom: 10px; grid-column: span 32; padding: 10px; border-radius: 5px; border: 2px solid #1a1a2e; display: flex; justify-content: space-between; align-items: center; gap: 10px;';
            
            div.innerHTML = `
              <h4 style="margin:0;">${i + 1}</h4>

              <input
                type="text"
                name="dependentsDetails[${i}][dependentsName]"
                class="form-control"
                value="${dependentsData[i]?.dependentsName || ''}"
                style="flex:1;border:1px solid #1a1a2e;"
              >

              <input
                type="date"
                name="dependentsDetails[${i}][dependentsDOB]"
                class="form-control"
                value="${dependentsData[i]?.dependentsDOB || ''}"
                style="flex:1;border:1px solid #1a1a2e;"
              >

              <input
                type="text"
                name="dependentsDetails[${i}][dependentsRelation]"
                class="form-control"
                value="${dependentsData[i]?.dependentsRelation || ''}"
                style="flex:1;border:1px solid #1a1a2e;"
              >
            `;

            container.appendChild(div);
        }
    }
  });

  // auto render dependents on edit
  if (dependentsData.length > 0) {
  const input = document.getElementById("dependents-count");
  input.value = dependentsData.length;
  input.dispatchEvent(new Event("input"));
  }
</script>

<script>
  const input = document.getElementById("emp-photo");
  const preview = document.getElementById("empPhotoPreview");

  // STEP 3: show existing image when editing
  <% if (employee?.empPhoto) { %>
    preview.src = "/employeeImages/<%= employee.empPhoto %>";
    preview.style.display = "block";
  <% } else { %>
    preview.style.display = "none";
  <% } %>

  // STEP 4: show preview when new image is selected
  input.addEventListener("change", () => {
    const file = input.files[0];

    if (!file || !file.type.startsWith("image/")) {
      preview.style.display = "none";
      preview.src = "";
      return;
    }

    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
      preview.style.display = "block";
    };
    reader.readAsDataURL(file);
  });
</script>


<script>
  const previewImg = document.getElementById("empPhotoPreview");
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImage");
  const closeBtn = document.querySelector(".close-btn");

  previewImg.addEventListener("click", () => {
    if (!previewImg.src) return;

    modalImg.src = previewImg.src;
    modal.style.display = "flex";
  });

  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ================= MOBILE FORMATTER ================= */
  function mobileInputFormatter(input) {
    if (!input) return;

    input.addEventListener("input", () => {
      const raw = input.value.trim();

      // allow single dash only if empty
      if (raw === "-") {
        input.value = "-";
        return;
      }

      // if user typed dash + digits, remove dash
      let digits = raw.replace(/\D/g, "").slice(0, 10);

      // if no digits and user cleared input
      if (!digits) {
        input.value = "";
        return;
      }

      // space after 5 digits → 98765 43210
      if (digits.length > 5) {
        digits = digits.slice(0, 5) + " " + digits.slice(5);
      }

      input.value = digits;
    });
  }

  /* ================= EMAIL FORMATTER ================= */
  function emailInputFormatter(input) {
    if (!input) return;

    input.addEventListener("input", () => {
      input.value = input.value.replace(/\s+/g, "").toLowerCase();
    });
  }

  /* ================= APPLY FORMATTERS ================= */
  [
    "emp-office-mob",
    "emp-mobile1",
    "emp-mobile2",
    "emp-emergency-no1",
    "emp-emergency-no2",
  ].forEach(id => mobileInputFormatter(document.getElementById(id)));

  [
    "emp-email",
    "emp-office-email-id",
  ].forEach(id => emailInputFormatter(document.getElementById(id)));

  /* ================= CLEAN BEFORE SUBMIT ================= */
  const form = document.querySelector("form");

  form.addEventListener("submit", () => {
    [
      "emp-office-mob",
      "emp-mobile1",
      "emp-mobile2",
      "emp-emergency-no1",
      "emp-emergency-no2",
      "emp-aadhaar",
    ].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;

      // keep dash as-is, clean only numbers
      if (el.value !== "-") {
        el.value = el.value.replace(/\s/g, "");
      }
    });
  });

});

/* ================= AADHAAR FORMATTER ================= */
function aadhaarInputFormatter(input) {
  if (!input) return;

  input.addEventListener("input", () => {
    let digits = input.value.replace(/\D/g, "").slice(0, 12);
    let formatted = digits.match(/.{1,4}/g);
    input.value = formatted ? formatted.join(" ") : "";
  });
}

aadhaarInputFormatter(document.getElementById("emp-aadhaar"));
</script>



